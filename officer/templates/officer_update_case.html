{% extends 'base_officer.html' %}

{% block title %}Update Case Status | Officer Portal{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow mb-4">
                <div class="card-header bg-primary text-white py-3">
                    <h5 class="mb-0">
                        <i class="fas fa-edit me-2"></i>Update Case Status
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST" class="needs-validation" novalidate>
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="status" class="form-label">Status</label>
                            <select class="form-select" id="status" name="status" required>
                                <option value="">Select Status</option>
                                <option value="Pending" {% if case.status == 'Pending' %}selected{% endif %}>Pending</option>
                                <option value="Under Progress" {% if case.status == 'Under Progress' %}selected{% endif %}>Under Progress</option>
                                <option value="Found" {% if case.status == 'Found' %}selected{% endif %}>Found</option>
                                <option value="Closed" {% if case.status == 'Closed' %}selected{% endif %}>Closed</option>
                            </select>
                            <div class="invalid-feedback">
                                Please select a status.
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="note" class="form-label">Note</label>
                            <textarea class="form-control" id="note" name="note" rows="3" required></textarea>
                            <div class="invalid-feedback">
                                Please add a note about this update.
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-end gap-2 mt-4">
                            <a href="{% url 'officer:officer_view_case_detail' case.id %}" class="btn btn-secondary">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Update Status
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
    // Form validation and submission
    (function () {
        'use strict';
        
        // Get the form element
        const form = document.querySelector('.needs-validation');
        
        if (form) {
            form.addEventListener('submit', function (event) {
                // Prevent default form submission
                event.preventDefault();
                
                // Check form validity
                if (!form.checkValidity()) {
                    event.stopPropagation();
                    form.classList.add('was-validated');
                    return false;
                }
                
                // Add loading state if needed
                const submitButton = form.querySelector('button[type="submit"]');
                if (submitButton) {
                    submitButton.disabled = true;
                    submitButton.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Updating...';
                }
                
                // Submit the form
                form.submit();
                
                return false;
            }, false);
        }
    })();
</script>
{% endblock %}

{% endblock %}


